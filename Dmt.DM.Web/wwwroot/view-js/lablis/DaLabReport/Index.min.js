function gridList(){var n=$("#gridList");n.dataGrid({datatype:"local",height:$(window).height()-125,colModel:[{label:"大项代码",name:"TestCode",hidden:!0},{label:"大项名称",name:"TestName",width:120,align:"left"},{label:"子项简称",name:"ShortName",width:100,align:"left"},{label:"子项名称",name:"Sinonym",width:150,align:"left"},{label:"结果",name:"Final",width:80,align:"center",formatter:function(n,t,i){return changeCellColor(n,t,i)}},{label:"结果描述",name:"LongTxt",width:80,align:"left"},{label:"异常标识",name:"Rn20",width:80,align:"center"},{label:"参考值",name:"DispLowHigh",width:80,align:"left"},{label:"标本时间",name:"CollectDate",width:80,align:"left"},{label:"报告时间",name:"SubmitDate",width:80,align:"left"},{label:"样本类型",name:"SampleType",width:80,align:"left"}],pager:"#gridPager",viewrecords:!0})}function changeCellColor(n,t,i){if(!!n&&!isNaN(n)&&!0){if(i.Rn20==="↓")return'<b style="color:#87ceeb">'+n+"<\/b>";if(i.Rn20==="↑")return'<b style="color:#eba589">'+n+"<\/b>"}return n}var combineDict=[{id:"1085",name:"血常规"},{id:"1270",name:"PTH"},{id:"1330",name:"TP-Ab"},{id:"137",name:"电解质三项"},{id:"150",name:"TP"},{id:"151",name:"ALB"},{id:"152",name:"GLOB"},{id:"153",name:"A/G"},{id:"174",name:"Ca"},{id:"175",name:"P"},{id:"176",name:"Mg"},{id:"183",name:"UREA"},{id:"184",name:"CREA"},{id:"185",name:"UA"},{id:"319",name:"HCV-Ab"},{id:"323",name:"HBsAg"},{id:"324",name:"HBsAb"},{id:"325",name:"HBeAg"},{id:"326",name:"HBeAb"},{id:"327",name:"HBcAb"},{id:"334",name:"HIV-Ab"}],daResult=[];$(function(){$("#report-list").height($(window).height()-130);gridList();$("#btn-daquery").on("click",function(){$.submitForm({url:"/LabLis/DaLabReport/FetchDaResult",loading:"正在查询迪安报告...",param:{startDate:$("#da-startdate").val(),endDate:$("#da-enddate").val()},success:function(n){var t,i;daResult=n.data;t=$("#report-list");t.empty();t.html("");i="";$.each(daResult,function(n,t){$.each(t.Servgrps,function(n,r){$.each(r,function(n,r){var f=r.Servgrp,u="";$.each(r.Rows,function(n,t){var i=$.grep(combineDict,function(n){return n.id===t.TestCode});u=i.length>0?u+i[0].name+"&nbsp;&nbsp;":u+t.TestCode+"&nbsp;&nbsp;"});i=i+'                                            <a class="list-group-item">                                                <span class="badge">'+r.Rows.length+'<\/span>                                                <h5 class="list-group-item-heading"><strong>'+t.Barcode+'<\/strong>&nbsp;&nbsp;&nbsp;&nbsp;<i style="float: right;margin-right: 18px;">'+f+'<\/i><\/h5>                                                <p class="list-group-item-text">                                                    <div class="row">                                                        <div class="col-xs-4 col-sm-3 col-md-3"><strong>'+t.PatientName+'<\/strong><\/div>                                                        <div class="col-xs-3 col-sm-2 col-md-2">'+(t.Gender==="女"?'<i class="fa fa-female"><\/i>':'<i class="fa fa-male"><\/i>')+'<\/div>                                                        <div class="col-xs-3 col-sm-2 col-md-2">'+t.Age+t.AgeUnit+'<\/div>                                                    <\/div>                                                <\/p>                                                <p class="list-group-item-text">'+u+"<\/p>                                            <\/a>                                            "})})});t.html(i);t.find(".list-group-item").on("click",function(n){var i=$(n.currentTarget).find(".list-group-item-heading"),u=i.find("strong")[0].innerText,f=i.find("i")[0].innerText,r=[],t;$.each(daResult,function(n,t){if(t.Barcode===u)return r=t.Servgrps,!1});t=[];$.each(r,function(n,i){var r=$.grep(i,function(n){return n.Servgrp===f});r.length>0&&$.each(r[0].Rows,function(n,i){var r="";$.each(combineDict,function(n,t){if(t.id===i.TestCode)return r=t.name,!1});$.each(i.Items,function(n,u){t.push({TestCode:i.TestCode,TestName:r,SampleType:i.SampleType,CollectDate:i.CollectDate.substr(5,5)+" "+i.CollectDate.substr(11,5),SubmitDate:i.SubmitDate.substr(5,5)+" "+i.SubmitDate.substr(11,5),ApprDate:i.ApprDate,TestDate:i.TestDate,Sinonym:u.Sinonym,ShortName:u.ShortName,Units:u.Units,Final:u.Final,Analyte:u.Analyte,DispLowHigh:u.DispLowHigh,S:u.S,SynonimEn:u.SynonimEn,LowB:u.LowB,HighB:u.HighB,Sorter:u.Sorter,LongTxt:u.LongTxt,RangeFlag:u.RangeFlag,Rn10:u.Rn10,Rn20:u.Rn20})})})});$("#gridList").jqGrid("clearGridData").setGridParam({data:t}).trigger("reloadGrid")})}})})});