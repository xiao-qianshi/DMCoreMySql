function gridList(){var n=$("#gridList");n.dataGrid({url:"/PatientManage/PatVisit/GetGridJson",postData:getParms(),height:$(window).height()-128,colModel:[{label:"主键",name:"F_Id",hidden:!0},{label:"透析日期",name:"F_VisitDate",width:60,align:"left",formatter:"date",formatoptions:{srcformat:"Y-m-d",newformat:"Y-m-d"}},{label:"班次",name:"F_VisitNo",width:30,align:"center"},{label:"透析号",name:"F_DialysisNo",width:60,align:"left"},{label:"姓名",name:"F_Name",width:40,align:"left"},{label:"性别",name:"F_Gender",width:30,align:"left"},{label:"透析方式",name:"F_DialysisType",width:60,align:"left"},{label:"血管通路",name:"F_VascularAccess",width:120,align:"left"},{label:"通路名称",name:"F_AccessName",width:90,align:"left"},{label:"肝素类型",name:"F_HeparinType",width:120,align:"left"},{label:"首剂",name:"F_HeparinAmount",width:40,align:"left"},{label:"追加量",name:"F_HeparinAddAmount",width:40,align:"left"},{label:"滤器",name:"F_DialyzerType1",width:80,align:"left"},{label:"灌流器",name:"F_DialyzerType2",width:80,align:"left"},{label:"记账",name:"F_IsAcct",width:60,align:"center",formatter:function(n){return n==1?'<span class="label label-success">已记账<\/span>':'<span class="label label-default">未记账<\/span>'}},{label:"危重",name:"F_IsCritical",width:40,align:"center",formatter:function(n){return n==1?'<span class="label label-default">禁用<\/span>':""}},{label:"组别",name:"F_GroupName",width:40,align:"left"},{label:"床号",name:"F_DialysisBedNo",width:40,align:"left"},{label:"仪器名",name:"F_MachineName",width:80,align:"left"},{label:"创建日期",name:"F_CreatorTime",width:80,align:"left",formatter:"date",formatoptions:{srcformat:"Y-m-d",newformat:"Y-m-d"}},{label:"患者主键",name:"F_Pid",hidden:!0}],pager:"#gridPager",sortname:"F_CreatorTime desc",viewrecords:!0});$("#btn_search").click(function(){n.jqGrid("setGridParam",{postData:getParms()}).trigger("reloadGrid")})}function getParms(){var n={},i=$("#startDate").val(),t;return!i||(n.startDate=i),t=$("#endDate").val(),!t||(n.endDate=t),n.visitNo=$("#visitNo").val(),n.status=$("#status").val(),n.keyword=$("#txt_keyword").val(),n}function btn_add(){$.modalOpen({id:"Form",title:"新增治疗单",url:"/PatientManage/PatVisit/Form",width:"920px",height:"800px",callBack:function(n){top.frames[n].submitForm()}})}function btn_edit(){var n=$("#gridList").jqGridRowValue().F_Id;!n||$.modalOpen({id:"Form",title:"修改治疗单",url:"/PatientManage/PatVisit/Form?keyValue="+n,width:"920px",height:"800px",callBack:function(n){top.frames[n].submitForm()}})}function btn_delete(){var n=$("#gridList").jqGridRowValue().F_Id;!n||$.deleteForm({url:"/PatientManage/PatVisit/DeleteForm",param:{keyValue:n},success:function(){$.currentWindow().$("#gridList").trigger("reloadGrid")}})}function btn_details(){var n=$("#gridList").jqGridRowValue().F_Id;!n||$.modalOpen({id:"Details",title:"查看治疗单",url:"/PatientManage/PatVisit/Form?keyValue="+n,width:"920px",height:"800px",btn:null})}function btn_nurse(){var n=$("#gridList").jqGridRowValue().F_Pid+"^"+$("#gridList").jqGridRowValue().F_VisitDate+"^"+$("#gridList").jqGridRowValue().F_DialysisNo,t=$("#gridList").jqGridRowValue().F_Pid;!t||$.modalOpen({id:"ObDetails",title:"执行医嘱",url:"/PatientManage/PatVisit/ObDetails?keyValue="+n,width:"950px",height:"600px",callBack:function(n){top.frames[n].submitForm()}})}function btn_print(){var n=$("#gridList").jqGridRowValue().F_Id;!n||$.post("/PatientManage/PatVisit/GetReportImage?keyValue="+n,{postdata:n},function(n){$("#print").html(n);$("#print").attr("style","display:block;");$("#print").jqprint();$("#print").attr("style","display:none;")})}function printcard(n){$("#print").html(n);$("#print").attr("style","display:block;");$("#print").jqprint();$("#print").attr("style","display:none;")}function btn_acct(){var n=$("#gridList").jqGridRowValue().F_Id;!n||$.submitForm({url:"/PatientManage/PatVisit/SubmitCharge",param:{keyValue:n},success:function(){$.currentWindow().$("#gridList").jqGrid("setGridParam",{postData:getParms()}).trigger("reloadGrid")}})}function btn_printbatch(){$.modalOpen({id:"Form",title:"批量打印",url:"/PatientManage/PatVisit/Prepare",width:"800px",height:"600px",btn:null})}function btn_printbatch2(){$.modalOpen({id:"Form",title:"批量打印",url:"/PatientManage/PatVisit/PrintBatch",width:"800px",height:"600px",btn:null})}function btn_printcard(){$.modalOpen({id:"Form",title:"筛选条件",url:"/PatientManage/PatVisit/CheckFilter?keyValue="+(new Date).Format("yyyy-MM-dd"),width:"500px",height:"420px",callBack:function(n){top.frames[n].submitForm()}})}$(function(){$("#print").attr("style","display:none;");$("#visitNo").bindSelect();$("#status").bindSelect();gridList()});Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};