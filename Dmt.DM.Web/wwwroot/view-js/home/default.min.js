function setForm(){function t(){$.ajax({url:"/PatientManage/Nurse/GetListByVisitJson",data:{visitId:selectid},dataType:"json",async:!1,success:function(n){$("#ob-gridList").jqGrid("clearGridData");$("#ob-gridList").setGridParam({data:n}).trigger("reloadGrid")}})}function i(){$.ajax({url:"/PatientManage/Puncture/GetPuncturePicPath",data:{keyValue:currentPid},dataType:"json",async:!0,success:function(n){n.fileName?($("#img-puncture").attr("src","\\"+n.filePath+"\\"+n.fileName),$("#img-puncture").attr("alt",n.fileName)):($("#img-puncture").attr("src",""),$("#img-puncture").attr("alt",""))}});$.ajax({url:"/PatientManage/Puncture/GetListJson",data:{keyValue:currentPid},dataType:"json",async:!1,success:function(n){var t=$("#punctureItems");t.find("tr").remove();n.length>0&&n.forEach(function(n){t.append("<tr><td>"+n.F_OperateTime+"<\/td><td>"+n.F_Point1+" - "+n.F_Point2+"<\/td><td>"+n.F_RealName+"<\/td><td>"+n.F_Memo+"<\/td><\/tr>")})}})}function r(){$.ajax({url:"/PatientManage/Evaluation/GetFormByVisitIdJson",dataType:"json",data:{keyValue:selectid},async:!1,success:function(n){var i=$("#extend"),r;if(!n)pgdId="",i.find("input[type='checkbox']:checked").prop("checked",!1),i.find("input[type='text']").val("");else{pgdId=n.F_Id;for(r in n){var t=i.find("#"+r),u=$.trim(n[r]).replace(/&nbsp;/g,""),f=t.attr("type");t.hasClass("select2-hidden-accessible")&&(f="select");switch(f){case"checkbox":u=="true"?t.prop("checked",!0):t.removeAttr("checked");break;case"select":t.val(u).trigger("change");break;default:t.val(u)}}return!1}}})}function u(){$.ajax({url:"/PatientManage/PatVisit/GetFormJson",dataType:"json",data:{keyValue:selectid},async:!1,success:function(n){var f=$("#basic"),i;if(!n)$("#IdeaWeight").val("");else{for(i in n){var t=f.find("#"+i),r=$.trim(n[i]).replace(/&nbsp;/g,""),u=t.attr("type");t.hasClass("select2-hidden-accessible")&&(u="select");switch(u){case"checkbox":r=="true"?t.prop("checked",!0):t.removeAttr("checked");break;case"select":t.val(r).trigger("change");break;default:t.val(r)}}$("#Custom_WeightYT").val(n.F_WeightYT);$("#summaryContent").val(n.F_Memo);n.F_DialysisStartTime===null||n.F_DialysisStartTime===""||n.F_DialysisStartTime===undefined?($("#btn-operator").show(),$("#operateTime").show(),$("#btn-operator").html('<i class="fa fa-play"><\/i>上机').removeClass("btn-danger").removeClass("btn-success").addClass("btn-warning"),$("#operateTime").attr("placeholder","上机时间(默认为当前时间)")):n.F_DialysisEndTime===null||n.F_DialysisEndTime===""||n.F_DialysisEndTime===undefined?n.F_CheckPerson===null||n.F_CheckPerson===""||n.F_CheckPerson===undefined?($("#btn-operator").show(),$("#operateTime").show(),$("#btn-operator").html('<i class="fa fa-stop-circle-o"><\/i>审核').removeClass("btn-warning").removeClass("btn-danger").addClass("btn-success"),$("#operateTime").attr("placeholder","审核时间(默认为当前时间)")):($("#btn-operator").show(),$("#operateTime").show(),$("#btn-operator").html('<i class="fa fa-stop"><\/i>下机').removeClass("btn-warning").removeClass("btn-success").addClass("btn-danger"),$("#operateTime").attr("placeholder","下机时间(默认为当前时间)")):($("#btn-operator").hide(),$("#operateTime").hide());$.ajax({url:"/PatientManage/Patient/GetIdeaWeightJsonById",dataType:"json",data:{keyValue:n.F_Pid},async:!0,success:function(n){var t=parseFloat(n);t>5?$("#IdeaWeight").val(t):$("#IdeaWeight").val("")}})}}})}function f(){$.ajax({url:"/PatientManage/PatVisit/GetFormJson",dataType:"json",data:{keyValue:selectid},async:!1,success:function(n){var f=$("#extend7"),r,t,i,u;if(!!n)for(r in n)if(t=f.find("#"+r),t.length!==0||(t=f.find('input[name="'+r+'"]'),t.length!==0)){i=$.trim(n[r]).replace(/&nbsp;/g,"");u=t.attr("type");t.hasClass("select2-hidden-accessible")&&(u="select");switch(u){case"checkbox":i=="true"?t.prop("checked",!0):t.removeAttr("checked");break;case"select":t.val(i).trigger("change");break;case"radio":t.each(function(n,t){t.checked=t.value===i?!0:!1});break;default:t.val(i)}}}})}function e(){$.ajax({url:"/PatientManage/PatVisit/GetFormJson",dataType:"json",data:{keyValue:selectid},async:!1,success:function(n){!n||$("#summaryContent").val(n.F_Memo)}})}if(selectid==="")return!1;var n=$("ul.nav.nav-tabs").find("li.active").find("a").first(),o=n[0].innerText;switch(n[0].innerText){case"透析参数":u();break;case"透前评估":r();break;case"穿刺记录":i();break;case"观察记录":t();break;case"过程监测":f();break;case"疗效评价":e()}}function initControl(){var t,i,r,u,f,o,s;$.when(t,i,r,f,o,s);$("#F_DilutionType").bindSelect();$("#F_DialysisType").bindSelect({url:"/SystemManage/ItemsData/GetSelectJson?enCode=DialysisType",id:"id",text:"text",change:function(n){n.id=="HDF"?$("#F_DilutionType").val("前稀释"):$("#F_DilutionType").val("")}});$("#F_VascularAccess").bindSelect();t=$.ajax({url:"/PatientManage/Drugs/GetSelectJson",dataType:"json",async:!0,success:function(n){var t=[],i={};i.id="";i.text="无肝素";t.push(i);$.each(n,function(n,i){var r={};r.id=i.id;r.text=i.text;t.push(r)});$("#F_HeparinType").bindSelect({id:"id",text:"text",data:t,change:function(n){var t=n.id;t==""?($("#HeparinUnit").html(""),$("#HeparinAddSpeedUnit").html(""),$("#F_HeparinUnit").val(""),$("#F_HeparinAddSpeedUnit").val(""),$("#F_HeparinUnit").val(""),$("#F_HeparinAddSpeedUnit").val(""),$("#F_HeparinAmount").val(""),$("#F_HeparinAddAmount").val("")):$.ajax({url:"/PatientManage/Drugs/GetFormJson",dataType:"json",data:{keyValue:t},async:!1,success:function(n){$("#HeparinUnit").html(n.F_DrugMiniSpec);$("#HeparinAddSpeedUnit").html(n.F_DrugMiniSpec+"/h");$("#F_HeparinUnit").val(n.F_DrugMiniSpec);$("#F_HeparinAddSpeedUnit").val(n.F_DrugMiniSpec+"/h")}})}})}});$("#F_AccessName").bindSelect();i=$.ajax({url:"/PatientManage/Material/GetSelectJson",dataType:"json",async:!0,success:function(n){var t=[],i={};i.id="";i.text="";t.push(i);$.each(n,function(n,i){var r={};r.id=i.id;r.text=i.text;t.push(r)});$("#F_DialyzerType1").bindSelect({data:t})}});r=$.ajax({url:"/PatientManage/Material/GetSelectByTypeJson",data:{keyword:"灌流器"},dataType:"json",async:!0,success:function(n){var t=[],i={};i.id="";i.text="";t.push(i);$.each(n,function(n,i){var r={};r.id=i.id;r.text=i.text;t.push(r)});$("#F_DialyzerType2").bindSelect({data:t})}});$("#btn-savepgd").on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n={};n.F_Id=pgdId;n.F_Pid=currentPid;n.F_VisitDate=$("#visitDate").val();pgdId===""&&(n.F_VisitDate=$("#visitDate").val());$("#extend").find("input,select,textarea").each(function(){var i=$(this),r=i.attr("id"),u=i.attr("type"),t;switch(u){case"checkbox":n[r]=i.is(":checked");break;default:t=i.val()==""?"&nbsp;":i.val();t==null&&(t="&nbsp;");pgdId||(t=t.replace(/&nbsp;/g,""));n[r]=t}});$.submitForm({url:"/PatientManage/Evaluation/SubmitForm",param:{entity:n,keyValue:pgdId},success:function(){}})}});$("#btn-pgdmodel").on("click",function(){$("#extend").find("#Rsfs1,#Xy1,#Xl1,#Hx1,#Tw1,#Shzlnl1,#Tl1,#Ww1,#Sy1,#Yslkz1,#Sm1,#Nl1,#Cx1,#Yyqk4,#Qctxhqk1,#Tsqk1,#Nlccdqk1,#Sfsctx2,#Wytxywbs1,#Place1,#Sctxcczz1,#Xgzy1,#Nlcsxl1,#Nlsynx4,#Jkjyfs1,#Jkjyfs2,#Yszd1,#Yszd2,#Yszd3,#Yszd4,#Yszd5,#Ydzd1,#Ydzd2,#Ydzd3,#Xgtlzd1,#Xgtlzd2,#Xgtlzd3,#Xgtlzd4,#Tzgl1,#Tzgl2,#Tzgl3,#Sjz1").prop("checked",!0);$("#extend").find("#Ddvalue1").val("1")});$("#btn-pgdclear").on("click",function(){$("#extend").find("input[type='checkbox']:checked").prop("checked",!1);$("#extend").find("input[type='text']").val("")});$("#btn-pgdprint").on("click",function(){$.ajax({url:"/PatientManage/Evaluation/GetFormByVisitIdJson",dataType:"json",data:{keyValue:selectid},async:!1,success:function(n){if(!n)return!1;$.post("/PatientManage/Evaluation/GetEvaluationImage?keyValue="+n.F_Id,function(n){$("#print").html(n);$("#print").attr("style","display:block;");$("#print").jqprint();$("#print").attr("style","display:none;")})}})});$("#IdeaWeight").on("change",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n=parseFloat($("#IdeaWeight").val());if(n<10)return!1;$.deleteForm({prompt:"注：是否修改【干体重】？",url:"/PatientManage/Patient/ModifyIdeaWeightForm",param:{pid:currentPid,ideaWeight:n},loading:"正在更新数据...",success:function(){},close:!0})}});$("#Custom_WeightYT").on("change",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n=parseFloat($("#Custom_WeightYT").val());if(n<0||n>5)return $("#Custom_WeightYT").focus(),$.modalAlert("预脱量范围【0-5】，请核对！","warning"),!1;$.post("/PatientManage/PatVisit/ModifyYTWeight",{keyValue:selectid,value:n},function(n,t){if(t==="success"){var i=JSON.parse(n);i.state!=="success"&&($("#Custom_WeightYT").focus(),$.modalAlert(i.message,"warning"))}else $.modalAlert(n,"warning")})}});$("#btn-savesetting").on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n={};$("#basic").find("input,select,textarea").each(function(){var t=$(this),i=t.attr("id"),u=t.attr("type"),r;switch(u){case"checkbox":n[i]=t.is(":checked");break;default:r=t.val()==""?"&nbsp;":t.val();n[i]=r}});$.submitForm({url:"/PatientManage/PatVisit/SubmitForm",param:{entity:n,keyValue:selectid},success:function(){$.post("/PatientManage/PatVisit/DoctorSign",JSON.stringify({keyValue:selectid}))}})}});$("#btn-operator").on("click",function(n){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var t=n.target.innerText===""?n.currentTarget.innerText:n.target.innerText;$.ajax({url:"/PatientManage/PatVisit/SaveOperateMachineTime",data:JSON.stringify({keyValue:JSON.stringify({id:selectid,operateTime:$("#operateTime").val(),operateType:n.target.innerText})}),type:"post",dataType:"json",async:!1,success:function(n){if(n.state=="success"){$.modalMsg(n.message,n.state);switch(t){case"上机":$.each(list,function(n,t){if(t.Id===selectid)return t.StartTime="111",!1});break;case"下机":$.each(list,function(n,t){if(t.Id===selectid)return t.EndTime="222",!1});break;case"审核":$.each(list,function(n,t){if(t.Id===selectid)return t.IsAcct||$.deleteForm({prompt:"注：是否扣减【库存】？",url:"/PatientManage/PatVisit/SubmitCharge",param:{keyValue:selectid},loading:"正在更新数据...",success:function(){t.IsAcct=!0},close:!0}),!1});$("#btn-operator").html('<i class="fa fa-stop"><\/i>下机').removeClass("btn-warning").removeClass("btn-success").addClass("btn-danger");$("#operateTime").attr("placeholder","下机时间(默认为当前时间)")}}else $.modalAlert(n.message,n.state);refreshList()}})}});$("#filterkeyword").keydown(function(n){var i,e,o,s;if(n.keyCode===13)if(console.log(this,$("#filterkeyword").val()),i=$("#filterkeyword").val(),!i)refreshList();else{if(list==undefined||list.length==undefined||list.length===0)return!1;var h=$("#visitNo").val(),r=$("#statusinit")[0].checked,u=$("#statusuncomplete")[0].checked,f=$("#statuscomplete")[0].checked,t=$.grep(list,function(n){return n.VisitNo==h});if(t.length===0||(t=r&&u&&f?t:r&&u?$.grep(t,function(n){return n.EndTime==""}):r&&f?$.grep(t,function(n){return n.StartTime==""||n.EndTime!=""}):u&&f?$.grep(t,function(n){return n.StartTime!=""}):r?$.grep(t,function(n){return n.StartTime==""}):u?$.grep(t,function(n){return n.StartTime!=""&&n.EndTime==""}):f?$.grep(t,function(n){return n.EndTime!=""}):[],t.length===0)||(e=$("#groupName").val(),!e||(t=$.grep(t,function(n){return n.GroupName==e})),t.sort(function(n,t){return parseInt(n.DialysisBedNo)-parseInt(t.DialysisBedNo)}),t.length===0))return!1;t=$.grep(t,function(n){return n.Py.indexOf(i)>=0||n.DialysisBedNo===i||n.Name.indexOf(i)>=0||n.DialysisNo==i});t.length>0&&(o=$("#patient-list"),o.empty(),t.forEach(function(n){o.append('<li class="list-group-item" id="'+n.Id+'"><span class="badge">'+n.GroupName+n.DialysisBedNo+'<\/span><h5 class="list-group-item-heading">'+(n.IsArchive?'<i class="fa fa-lock"><\/i>&nbsp;':"&nbsp;&nbsp;")+n.Name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+n.Gender+"&nbsp;&nbsp;"+n.AgeDesc+'<\/h5><p class="list-group-item-text">'+n.DialysisType+"&nbsp;&nbsp;&nbsp;"+n.VascularAccess+"&nbsp;&nbsp;&nbsp;"+n.HeparinType+"&nbsp;&nbsp;&nbsp;<\/p><\/li>")}),selectid="",currentPid="",pgdId="",$("#btn-operator").hide(),$("#operateTime").hide())}else n.keyCode===8&&(s=$("#filterkeyword").val(),s.length===1&&refreshList())});$("#btn-upload").on("click",function(){typeof selectid=="undefined"||selectid==null||selectid==""?$.modalMsg("请先选择透析记录！","warning"):$.modalOpen({id:"Form",title:"上传图片",url:"/PatientManage/Puncture/Upload?keyValue="+currentPid,width:"800px",height:"600px",callBack:function(n){top.frames[n].submitForm();$.ajax({url:"/PatientManage/Puncture/GetPuncturePicPath",data:{keyValue:currentPid},dataType:"json",async:!1,success:function(n){n.fileName&&($("#img-puncture").attr("src","\\"+n.filePath+"\\"+n.fileName),$("#img-puncture").attr("alt",n.fileName))}})}})});$("#btn-addpuncture").on("click",function(){var r=$("#btn-addpuncture"),n,t,u,i;if(r[0].innerText=="添加")r[0].innerHTML='<i class="fa fa-save"><\/i>保存',$("#title-punctureA").show(),$("#value-punctureA").show(),$("#title-punctureB").show(),$("#value-punctureB").show(),$("#ck-punctureSuccess").show();else{if(typeof selectid=="undefined"||selectid==null||selectid=="")return $.modalMsg("请先选择透析记录！","warning"),!1;if(n=$("#punctureA").val(),typeof n=="undefined"||n==null||n=="")return $.modalMsg("请填写动脉穿刺点！","warning"),$("#punctureA").focus(),!1;if(t=$("#punctureB").val(),typeof t=="undefined"||t==null||t=="")return $.modalMsg("请填写动脉穿刺点！","warning"),$("#punctureB").focus(),!1;u=$("#punctureSuccess").prop("checked");i=$("#punctureMemo").val();u||(typeof i=="undefined"||i==null||i=="")&&$("punctureMemo").focus();$.ajax({url:"/PatientManage/Puncture/SaveData",data:{keyValue:JSON.stringify({visitId:selectid,point1:n,point2:t,memo:i,isSuccess:$("#punctureSuccess").prop("checked")})},type:"post",dataType:"json",async:!1,success:function(){$("#punctureSuccess").prop("checked",!0);$("#table-punctureMemo").hide();$("#punctureMemo").val("");$.ajax({url:"/PatientManage/Puncture/GetListJson",data:{keyValue:currentPid},dataType:"json",async:!1,success:function(n){var t=$("#punctureItems");t.find("tr").remove();n.length>0&&n.forEach(function(n){t.append("<tr><td>"+n.F_OperateTime+"<\/td><td>"+n.F_Point1+" - "+n.F_Point2+"<\/td><td>"+n.F_RealName+"<\/td><td>"+n.F_Memo+"<\/td><\/tr>")})}})}});r[0].innerHTML='<i class="fa fa-plus"><\/i>添加';$("#title-punctureA").hide();$("#value-punctureA").hide();$("#title-punctureB").hide();$("#value-punctureB").hide();$("#ck-punctureSuccess").hide()}});$("#punctureSuccess").change(function(){var n=$("#punctureSuccess").prop("checked");n?($("#table-punctureMemo").hide(),$("#punctureMemo").val("")):$("#table-punctureMemo").show()});u=$("#ob-gridList");u.dataGrid({datatype:"local",height:$(window).height()-250,caption:"单位：机温℃，血压、动脉压、静脉压、TMPmmHg，电导率ms/cm，血流速ml/min，超滤率ml/h，超滤量、剩余肝素量ml",colModel:[{label:"主键",name:"F_Id",hidden:!0,key:!0},{label:"时间",name:"F_NurseOperatorTime",width:40,align:"left",formatter:"date",formatoptions:{srcformat:"Y-m-d H:i:s",newformat:"H:i"}},{label:"机温",name:"F_T",width:35,align:"center"},{label:"收缩压",name:"F_SSY",hidden:!0},{label:"舒张压",name:"F_SZY",hidden:!0},{label:"血压",name:"pressure",width:100,align:"center",formatter:function(n,t,i){return i.F_SSY+" / "+i.F_SZY}},{label:"脉搏",name:"F_HR",width:50,align:"center"},{label:"血流速",name:"F_BF",width:50,align:"center"},{label:"动脉压",name:"F_A",width:50,align:"center"},{label:"静脉压",name:"F_V",width:50,align:"center"},{label:"电导率",name:"F_C",width:50,align:"center"},{label:"TMP",name:"F_TMP",width:50,align:"center"},{label:"超滤率",name:"F_UFV",width:50,align:"center"},{label:"剩余肝素量",name:"F_GSL",width:50,align:"center"},{label:"超滤量",name:"F_UFR",width:50,align:"center"},{label:"记录者",name:"F_Nurse",width:50,align:"center"}],pager:"#ob-gridPager",sortname:"F_NurseOperatorTime desc",viewrecords:!0});$("#btn-obsave").on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")return $.modalMsg("请先选择透析记录！","warning"),!1;if(!$("#formObservation").formValid())return!1;$.ajax({url:"/PatientManage/Nurse/SaveData",data:JSON.stringify({visitId:selectid,Ob_NurseOperatorTime:$("#Ob_NurseOperatorTime").val(),Ob_SSY:$("#Ob_SSY").val(),Ob_SZY:$("#Ob_SZY").val(),Ob_HR:$("#Ob_HR").val(),Ob_A:$("#Ob_A").val(),Ob_V:$("#Ob_V").val(),Ob_BF:$("#Ob_BF").val(),Ob_UFV:$("#Ob_UFV").val(),Ob_C:$("#Ob_C").val(),Ob_T:$("#Ob_T").val(),Ob_UFR:$("#Ob_UFR").val(),Ob_TMP:$("#Ob_TMP").val(),Ob_GSL:$("#Ob_GSL").val(),Ob_MEMO:$("#Ob_MEMO").val()}),type:"post",dataType:"json",async:!1,success:function(n){n.state=="success"?$.modalMsg(n.message,n.state):$.modalAlert(n.message,n.state);$("#formObservation").find("input,textarea").each(function(){var n=$(this);n.val("")});$.ajax({url:"/PatientManage/Nurse/GetListByVisitJson",data:{visitId:selectid},dataType:"json",async:!1,success:function(n){$("#ob-gridList").jqGrid("clearGridData");$("#ob-gridList").setGridParam({data:n}).trigger("reloadGrid")}})}})});$("#btn-obcopy").on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")return $.modalMsg("请先选择透析记录！","warning"),!1;$.ajax({url:"/PatientManage/Nurse/GetSingleByVisitIdJson",data:{visitId:selectid},dataType:"json",async:!1,success:function(n){!n||($("#Ob_SSY").val(n.F_SSY),$("#Ob_SZY").val(n.F_SZY),$("#Ob_HR").val(n.F_HR),$("#Ob_A").val(n.F_A),$("#Ob_V").val(n.F_V),$("#Ob_BF").val(n.F_BF),$("#Ob_UFV").val(n.F_UFV),$("#Ob_C").val(n.F_C),$("#Ob_T").val(n.F_T),$("#Ob_UFR").val(n.F_UFR),$("#Ob_TMP").val(n.F_TMP))}})});f=$.ajax({url:"/PatientManage/ConclusionTemplate/GetSelectJson",data:{keyword:""},dataType:"json",async:!0,success:function(n){var t=$("#fileModel-list ul");$.each(n,function(n,i){t.append('<li class="list-group-item"><h5 class="list-group-item-heading">'+i.F_Title+'<\/h5><p class="list-group-item-text">'+i.F_Content+"<\/p><\/li>")});t.on("click",function(n){var i=n.target.localName,t="",r;i==="p"?t=n.target.innerText:i==="h5"?t=n.target.nextElementSibling.innerText:i==="li"&&(t=n.target.children[1].innerText);r=$("#summaryContent").val();$("#summaryContent").val(r+t);$("#summaryContent").focus()})}});$("#extend5 a.btn-primary").first().on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n={};n.id=selectid;n.content=$("#summaryContent").val();$.ajax({url:"/PatientManage/PatVisit/CommitMemo",data:JSON.stringify(n),dataType:"json",type:"post",async:!1,success:function(n){$.modalAlert(n.message,n.state)}})}});$("#extend5 a.btn-warning").first().on("click",function(){var n=$("#summaryContent").val();n!==""&&$.modalOpen({id:"Form",title:"新增模板",url:"/PatientManage/ConclusionTemplate/Add?keyword="+encodeURI(encodeURI(n)),width:"600px",height:"500px",callBack:function(n){top.frames[n].submitForm()}})});var n=$("#extend6"),e=new Date,h=new Date(e.getTime()-2592e6);n.find("#endDate").val(e.Format("yyyy-MM-dd"));n.find("#startDate").val(h.Format("yyyy-MM-dd"));o=$.ajax({url:"/PatientManage/QualityItem/GetSelectJson",dataType:"json",async:!0,success:function(t){var i=t;i.splice(0,0,{Id:"",Name:"全部"});n.find("#itemCode").bindSelect({data:t,id:"Id",text:"Name"})}});$("#gridListResult").dataGrid({datatype:"local",height:$(window).height()-248,colModel:[{label:"主键",name:"F_Id",hidden:!0},{label:"ID",name:"F_Pid",hidden:!0},{label:"代码",name:"F_ItemId",hidden:!0},{label:"报告日期",name:"F_ReportTime",width:120,align:"left",formatter:"time",formatoptions:{srcformat:"Y-m-d h:m:s",newformat:"Y-m-d h:m"}},{label:"项目代码",name:"F_ItemCode",width:100,align:"left"},{label:"项目名称",name:"F_ItemName",width:150,align:"left"},{label:"结果",name:"F_Result",width:100,align:"left"},{label:"单位",name:"F_Unit",width:80,align:"left"},{label:"备注",name:"F_Memo",width:300,align:"left"}],pager:"#gridPagerResult",rowNum:20,rowList:[10,20,30,40],sortname:"F_ReportTime Desc",viewrecords:!0,autowidth:!1,onPaging:function(){}});n.find("a.btn").on("click",function(){if(currentPid===null||currentPid==="")return!1;var n=$("#startDate").val(),t=$("#endDate").val();if(t===""||n==="")return!1;$.ajax({url:"/PatientManage/QualityResult/GetListJson",dataType:"json",async:!1,data:{patientId:currentPid,startDate:n,endDate:t,itemId:$("#itemCode").val()},success:function(n){var t=$("#gridListResult");t.jqGrid("clearGridData");t.setGridParam({data:n}).trigger("reloadGrid")}})});s=$.ajax({url:"/SystemManage/User/GetUserSelectJson",data:{keyValue:null},dataType:"json",async:!0,success:function(n){var t=[],i={};i.id="";i.text="     ";t.push(i);$.each(n,function(n,i){var r={};r.id=i.id;r.text=i.text;t.push(r)});$("#F_PuncturePerson").bindSelect({id:"id",text:"text",data:t,search:!0});$("#F_StartPerson").bindSelect({id:"id",text:"text",data:t,search:!0});$("#F_CheckPerson").bindSelect({id:"id",text:"text",data:t,search:!0});$("#F_EndPerson").bindSelect({id:"id",text:"text",data:t,search:!0})}});$("#btn-savegcjc").on("click",function(){if(typeof selectid=="undefined"||selectid==null||selectid=="")$.modalMsg("请先选择透析记录！","warning");else{var n={};$("#extend7").find("input,select,textarea").each(function(){var t=$(this),i=t.attr("id")||t.attr("name"),u=t.attr("type"),r;switch(u){case"checkbox":n[i]=t.is(":checked");break;case"radio":t.is(":checked")&&(n[i]=t.attr("value"));break;default:r=t.val()==""?"&nbsp;":t.val();n[i]=r}});$.submitForm({url:"/PatientManage/PatVisit/SubmitForm",param:{entity:n,keyValue:selectid},success:function(){}})}})}function refreshList(){var f=$("#patient-list"),n,u;f.empty();var e=$("#visitNo").val(),t=$("#statusinit")[0].checked,i=$("#statusuncomplete")[0].checked,r=$("#statuscomplete")[0].checked;list!=undefined&&list.length!=undefined&&list.length!==0&&(n=$.grep(list,function(n){return n.VisitNo==e}),n=t&&i&&r?n:t&&i?$.grep(n,function(n){return n.EndTime==""}):t&&r?$.grep(n,function(n){return n.StartTime==""||n.EndTime!=""}):i&&r?$.grep(n,function(n){return n.StartTime!=""}):t?$.grep(n,function(n){return n.StartTime==""}):i?$.grep(n,function(n){return n.StartTime!=""&&n.EndTime==""}):r?$.grep(n,function(n){return n.EndTime!=""}):[],u=$("#groupName").val(),!u||(n=$.grep(n,function(n){return n.GroupName==u})),n.sort(function(n,t){return parseInt(n.DialysisBedNo)-parseInt(t.DialysisBedNo)}),n.forEach(function(n){f.append('<li class="list-group-item" id="'+n.Id+'"><span class="badge">'+n.GroupName+n.DialysisBedNo+'<\/span><h5 class="list-group-item-heading">'+(n.IsArchive?'<i class="fa fa-lock"><\/i>&nbsp;':"&nbsp;&nbsp;")+n.Name+"&nbsp;&nbsp;&nbsp;"+n.Gender+"&nbsp;&nbsp;"+n.AgeDesc+'<\/h5><p class="list-group-item-text">'+n.DialysisType+"&nbsp;&nbsp;"+n.VascularAccess+"&nbsp;&nbsp;"+n.HeparinType+"&nbsp;&nbsp;<\/p><\/li>")}),selectid="",currentPid="",pgdId="",$("#btn-operator").hide(),$("#operateTime").hide())}function handleVisitDateChange(n){if(n!==undefined&&n.el.id!=="visitDate")return!1;var t=$("#visitDate").val();(t==null||t=="")&&(t=(new Date).Format("yyyy-MM-dd"));$.ajax({url:"/PatientManage/PatVisit/GetPatVisitListJson",dataType:"json",data:{visitDate:t},async:!1,success:function(n){list=n}});refreshList()}var list=[],selectid="",currentPid="",pgdId="";$(function(){$("#visitDate").val((new Date).Format("yyyy-MM-dd"));$("#patient-list").css({height:$(window).height()-225});$("#main-content").css({height:$(window).height()-95});$("#img-puncture").css({height:$(window).height()-210});$("#summaryContent").css({height:$(window).height()-210});$("#fileModel-list").css({height:$(window).height()-120});$("ul.nav.nav-tabs").on("shown.bs.tab",function(){setForm()});$("#visitNo").bindSelect();$("#groupName").bindSelect({url:"/SystemManage/ItemsData/GetSelectJson?enCode=BedGroup",id:"id",text:"text",async:!0,change:function(){refreshList()}});$("#visitNo").on("change",function(){refreshList()});$("#btn-refresh").on("click",function(){handleVisitDateChange()});$("#statusinit ,#statusuncomplete, #statuscomplete").on("change",function(){refreshList()});$("#visitNo").val("1");handleVisitDateChange();$("#patient-list").on("click",function(n){if(selectid=n.target.id,selectid===""&&(selectid=n.target.parentNode.id),selectid===undefined||selectid===null||selectid===""||selectid==="patient-list")return selectid="",currentPid="",pgdId="",!1;$(".list-group-item.active").removeClass("active");$("#"+selectid).addClass("active");$.each(list,function(n,t){if(t.Id===selectid)return currentPid=t.Pid,!1});setForm()});initControl()});Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};