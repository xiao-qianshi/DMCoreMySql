function initControl(){$("ul.nav.nav-tabs").on("shown.bs.tab",function(){!currentId||refresh()});$("#btn-addtxcs").on("click",function(){if(!!currentId){var n={};n.pid=currentId;n.keyValue="";$.modalOpen({id:"Form",title:"新建透析参数",url:"/PatientManage/Setting/Form?keyword="+encodeURI(JSON.stringify(n)),width:"800px",height:"600px",callBack:function(n){top.frames[n].submitData()}})}});$("#btn-addmodeltxcs").on("click",function(){!currentId||$.submitForm({url:"/PatientManage/Setting/CopyModel",param:{keyValue:currentId},success:function(){settxcs()}});event.preventDefault()});$("#access-list").height($(window).height()-170);$("#B_Type").bindSelect();$("#B_VascularAccess").bindSelect();$("#B_BodyPart").bindSelect();$("#B_BodyPosition").bindSelect();$("#formaccess").height($(window).height()-190);$("#formaccess").find("#accessimg").first().height($(window).height()-270);$("#B_EnabledMark").on("change",function(n){console.log(n);n.target.checked?$("#B_DisabledRemark").attr("style","display: none;"):$("#B_DisabledRemark").attr("style","display: block;")});$("#btn-uploadaccess").on("click",function(){!accessId||$.modalOpen({id:"Form",title:"上传图片",url:"/PatientManage/VascularAccess/Form?keyValue="+accessId,width:"800px",height:"600px",callBack:function(n){top.frames[n].submitForm()}})});$("#btn-addaccess").on("click",function(){if(!currentId)$.modalMsg("请选择患者！","warning");else{var n={};n.B_Id="";n.B_OperateTime="";n.B_FirstUseTime="";n.B_Type="";n.B_VascularAccess="";n.B_BloodSpeed=null;n.B_BloodSpeed_Idea=null;n.B_BodyPart="";n.B_BodyPosition="";n.B_DisabledRemark="";n.B_Pid="";n.B_Memo="";n.B_Complication="";$("#formaccess").formSerialize(n)}accessId=""});$("#btn-saveaccess").on("click",function(){if(!currentId)$.modalMsg("请选择患者！","warning");else{if(!$("#formaccess").formValid())return!1;var n={};n.F_Id=accessId;n.F_OperateTime=$("#B_OperateTime").val();n.F_FirstUseTime=$("#B_FirstUseTime").val();n.F_Type=$("#B_Type").val();n.F_VascularAccess=$("#B_VascularAccess").val();n.F_BloodSpeed=$("#B_BloodSpeed").val();n.F_BloodSpeed_Idea=$("#B_BloodSpeed_Idea").val();n.F_BodyPart=$("#B_BodyPart").val();n.F_BodyPosition=$("#B_BodyPosition").val();n.F_EnabledMark=$("#B_EnabledMark").prop("checked");n.F_DisabledRemark=$("#B_DisabledRemark").val();n.F_Pid=currentId;n.F_Memo=$("#B_Memo").val();n.F_Complication=$("#B_Complication").val();$.submitForm({url:"/PatientManage/VascularAccess/SubmitForm",param:{entity:n,keyValue:accessId},success:function(){setaccess()}})}});$("#btn-deleteaccess").on("click",function(){accessId?($.deleteForm({url:"/PatientManage/VascularAccess/DeleteForm",param:{keyValue:accessId},success:function(){setaccess()}}),$("#btn-addaccess").trigger("click")):$.modalMsg("请选择记录！","warning")});$("#ccjlimg").first().height($(window).height()-185);$("#ccjl-list").first().height($(window).height()-130);$("#btn-uploadccjl").on("click",function(){!currentId||$.modalOpen({id:"Form",title:"上传图片",url:"/PatientManage/Puncture/Upload?keyValue="+currentId,width:"800px",height:"600px",callBack:function(n){top.frames[n].submitForm();$.ajax({url:"/PatientManage/Puncture/GetPuncturePicPath",data:{keyValue:currentId},dataType:"json",async:!1,success:function(n){n.fileName?($("#ccjlimg").attr("src","\\"+n.filePath+"\\"+n.fileName),$("#ccjlimg").attr("alt",n.fileName)):($("#ccjlimg").attr("src",""),$("#ccjlimg").attr("alt",""))}})}})});$("#btn-addccjl").on("click",function(){if(!!currentId){var n={};n.pid=currentId;n.id="";$.modalOpen({id:"Form",title:"新增",url:"/PatientManage/Puncture/Form?keyword="+encodeURI(JSON.stringify(n)),width:"800px",height:"600px",callBack:function(n){top.frames[n].submitData()}})}});$("#bl-list").height($(window).height()-230);bleditor=new Simditor({textarea:$("#bl-editor"),toolbar:["title","bold","italic","underline","strikethrough","fontScale","|","ol","ul","blockquote","table","hr","|","indent","outdent","alignment"],toolbarFloat:!0});$("#bl-container").height($(window).height()-145);$("#btn-bladd").on("click",function(){!currentId||(blwsId="",$("#bl-contenttime").val((new Date).Format("yyyy-MM-dd HH:mm:ss")),$("#bl-title").val(""),bleditor.setValue(""))});$("#btn-blsave").on("click",function(){var n,t,i;if(!!currentId){if(n=$("#bl-contenttime").val(),n===""||n===null)return $.modalMsg("请填写文档时间","warn"),!1;if(t=$("#bl-title").val(),t===""||t===null)return $.modalMsg("请填写文档标题","warn"),!1;if(i=$("<div>").text(bleditor.getValue()).html(),i===""||i===null)return $.modalMsg("请填写病历正文","warn"),!1;$.submitForm({url:"/PatientManage/MedicalRecord/SubmitForm",param:{entity:{F_Pid:currentId,F_Title:t,F_Content:i,F_ContentTime:n},keyValue:blwsId},success:function(){setblws();$("#btn-bladd").trigger("click")}})}});$("#btn-bldelete").on("click",function(){!blwsId||$.deleteForm({url:"/PatientManage/MedicalRecord/DeleteForm",param:{keyValue:blwsId},success:function(){setblws();$("#btn-bladd").trigger("click")}})});$("#btn-blquery").on("click",function(){!currentId||(setblws(),$("#btn-bladd").trigger("click"))});$("#btn-blprint").on("click",function(){!currentId||$.modalOpen({id:"Form",title:"打印病历",url:"/PatientManage/MedicalRecord/Print?keyValue="+currentId,width:"950px",height:"800px",btn:null})});var n=(new Date).Format("yyyy-MM-dd");$("#yz-startdate,#yz-enddate").val(n);$("#yz-list").height($(window).height()-405);$.ajax({url:"/PatientManage/Drugs/GetListJson",dataType:"json",async:!1,success:function(n){drugsDict=n;drugList=[];drugList.push({id:"",text:"请选择药品"});heparinList=[];heparinList.push({id:"",text:"请选择药品"});$.each(n,function(n,t){var i=t.F_DrugName+"("+t.F_DrugSpell+")",r=t.F_Id;drugList.push({id:r,text:i});t.F_IsHeparin==!0&&heparinList.push({id:r,text:i})})}});$("#yz-newdata").find("select").not("#YZ_OrderCode").each(function(n,t){$(t).bindSelect()});$("#yz-newdata").find('[data-toggle="tooltip"]').tooltip({html:!0}).on("show.bs.tooltip",function(){var n="...",t=$("#YZ_OrderCode").val();!t||$.each(drugsDict,function(i,r){if(r.F_Id==t){var u=r;return n='                            <div align="left">                                <p><strong>规格:<\/strong>&nbsp;&nbsp;'+(u.F_DrugSpec==null?"":u.F_DrugSpec)+"<\/p>                                <p><strong>单位:<\/strong>&nbsp;&nbsp;"+(u.F_DrugUnit==null?"":u.F_DrugUnit)+"<\/p>                                <p><strong>小剂量:<\/strong>&nbsp;&nbsp;"+(u.F_DrugMiniAmount==null?"":u.F_DrugMiniAmount)+"<\/p>                                <p><strong>小规格:<\/strong>&nbsp;&nbsp;"+(u.F_DrugMiniSpec==null?"":u.F_DrugMiniSpec)+"<\/p>                                <p><strong>单价:<\/strong>&nbsp;&nbsp;"+(u.F_Charges==null?"":u.F_Charges)+"<\/p>                                <p><strong>厂商:<\/strong>&nbsp;&nbsp;"+(u.F_DrugSupplier==null?"":u.F_DrugSupplier)+"<\/p>                            <\/div>                            ",!1}});$('[data-toggle="tooltip"]').attr("data-original-title",n)});$("#YZ_OrderCode").bindSelect({data:drugList,search:!0,change:function(n){if(!!n.id){var t=$($("#YZ_OrderCode").parent()[0].nextElementSibling);$.each(drugsDict,function(i,r){if(r.F_Id==n.id)return t.find("input").val(r.F_DrugMiniAmount),t.find("span").html(r.F_DrugMiniSpec),$("#YZ_OrderAdministration").val(r.F_DrugAdministration),!1})}}});$("#yz-newdata").find("i.fa").on("click",function(n){var i=$(n.currentTarget),t;i.is(".fa-plus")&&($("#yz-newdata").append('                                <div class="row" style="margin-top: 3px;">                                    <div class="col-md-3 col-md-push-2" style="padding-left: 1px;padding-right: 1px;">                                        <select type="text" class="form-control required"><\/select>                                    <\/div>                                    <div class="col-md-2 col-md-push-2" style="padding-left: 1px;padding-right: 1px;">                                        <div class="input-group">                                            <input type="number" class="form-control" placeholder="剂量" aria-describedby="drug-unit">                                            <span class="input-group-addon" id="drug-unit">u<\/span>                                        <\/div>                                    <\/div>                                <\/div>                                '),t=$("#yz-newdata").find("div.row").last(),t.find("select").bindSelect({data:drugList,search:!0,change:function(n){if(!!n.id){var i=$(t.find("div.input-group")[0]);$.each(drugsDict,function(t,r){if(r.F_Id==n.id)return i.find("input").val(r.F_DrugMiniAmount),i.find("span").html(r.F_DrugMiniSpec),!1})}}}))});$("#btn-yzsave").on("click",function(){var n,t;!currentId||(n={},n.isTemporary=$("#YZ_IsTemporary").val()==="true"?!0:!1,n.orderStartTime=$("#YZ_OrderStartTime").val(),n.orderFrequency=$("#YZ_OrderFrequency").val(),n.orderAdministration=$("#YZ_OrderAdministration").val(),n.pid=currentId,n.items=[],t=$("#yz-newdata").find("div.row"),$.each(t,function(t,i){var r,u;t===0?(r=$(i.children[1]).find("select").val(),u=$(i.children[2]).find("input").val(),!r||n.items.push({orderCode:r,orderAmount:u})):(r=$(i.children[0]).find("select").val(),u=$(i.children[1]).find("input").val(),!r||n.items.push({orderCode:r,orderAmount:u}))}),n.items.length>0&&$.ajax({url:"/PatientManage/Orders/SubmitDrugOrder",data:JSON.stringify(n),dataType:"json",async:!1,type:"post",contentType:"application/json",success:function(){setypyz();$.each($("#yz-newdata").find("div.row"),function(n,t){n===0?($(t.children[1]).find("select").val("").trigger("change"),$(t.children[2]).find("input").val("")):$(t).remove()})}}))});$("#btn-yzquery").on("click",function(){!currentId||setypyz()});$("#btn-yzaudit").on("click",function(){!currentId||$.modalConfirm("注：您确定要【提交】全部医嘱吗？",function(n){n&&$.submitForm({url:"/PatientManage/Orders/BatchAuditDrugOrder",param:{patientId:currentId,startDate:$("#yz-startdate").val(),endDate:$("#yz-enddate").val()},success:function(){setypyz()}})})});$("#btn-daquery").on("click",function(){});$("#yxjContent").height($(window).height()-150);$.ajax({url:"/PatientManage/Material/GetSelectJson",dataType:"json",async:!1,success:function(n){var t=[],i={};i.id="";i.text="";t.push(i);$.each(n,function(n,i){var r={};r.id=i.id;r.text=i.text;t.push(r)});$("#H_HDDialyzerType").bindSelect({data:t});$("#H_HFDialyzerType").bindSelect({data:t});$("#H_HDFDialyzerType").bindSelect({data:t});$("#H_HDHPDialyzerType").bindSelect({data:t})}});$("#H_VascularAccess").bindSelect();$("#H_AccessName").bindSelect();$("#H_HeparinType").bindSelect({data:heparinList,search:!0,change:function(n){!n.id||$.each(drugsDict,function(t,i){if(i.F_Id==n.id)return $("#H_HeparinUnit").html(i.F_DrugMiniSpec),!1})}});$("#yxj-query").click(function(){if(!!currentId){var n=$("#yxj-month").val();n==null||n==""?(n=(new Date).Format("yyyy-MM"),$("#yxj-month").val(n)):n=n.substr(0,7);$.ajax({url:"/PatientManage/Patient/GetMonthlySummaryJson",data:{patientId:currentId,month:n},dataType:"json",async:!1,success:function(n){var t=JSON.parse(JSON.stringify(n).replace(/F_/g,"H_"));console.log(n,t)}})}})}function resetTitle(n){!n||$.ajax({url:"/PatientManage/Patient/GetSinglePatient",data:{keyValue:n},dataType:"json",async:!1,success:function(n){currentId=n.F_Id;$("#patientName").html(n.F_Name);n.F_Gender==="男"?$("#patientGender").removeClass().addClass("fa").addClass("fa-male"):n.F_Gender==="女"?$("#patientGender").removeClass().addClass("fa").addClass("fa-female"):$("#patientGender").removeClass();$("#patientAge").html(n.F_AgeStr);$("#dialysisNo").html(n.F_DialysisNo);n.F_BeInfected===!0?$("#beInfected").removeClass().addClass("fa").addClass("fa-star"):$("#beInfected").removeClass();refresh()}})}function refresh(){var n=$("ul.nav.nav-tabs").find("li.active")[0].innerText;n==="透析参数"?settxcs():n==="血管通路"?(accessId="",setaccess()):n==="穿刺记录"?setccjl():n==="病历文书"?(blwsId="",setblws()):n==="医嘱用药"?setypyz():n==="转归记录"&&settransfer()}function settxcs(){$.ajax({url:"/PatientManage/Setting/GetList",data:{keyword:currentId},dataType:"json",async:!1,success:function(n){var i="",t;if($.each(n,function(n,t){i=i+'                    <div class="col-xs-10 col-sm-9 col-md-7 col-lg-5">                        <div class="panel panel-default" id="'+t.F_Id+'">                            <div class="panel-heading">                                <strong style="font-size:15px;">'+t.F_DialysisType+'<\/strong>                                <div style="float: right;">                                    <i class="fa fa-edit fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                    <i class="fa fa-trash fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                <\/div>                            <\/div>                            <div class="panel-body">                                <div class="rows">                                    <div style="float: left;width: 49%;">                                        <strong>血管通路&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_VascularAccess===null?"&nbsp;&nbsp;&nbsp;":t.F_VascularAccess)+'                                    <\/div>                                    <div style="float: right;width: 50%;">                                        <strong>部位(名称)&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_AccessName===null?"&nbsp;&nbsp;&nbsp;":t.F_AccessName)+'                                    <\/div>                                <\/div>                                <div class="rows">                                    <div style="float: left;width: 49%;">                                        <strong>抗凝剂&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_HeparinTypeName===null?"无":t.F_HeparinTypeName)+'                                    <\/div>                                    <div style="float: right;width: 25%;">                                        <strong>追加&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_HeparinAddAmount===null?"&nbsp;&nbsp;&nbsp;":t.F_HeparinAddAmount+t.F_HeparinAddSpeedUnit)+'                                    <\/div>                                    <div style="float: right;width: 25%;">                                        <strong>首剂&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_HeparinAmount===null?"&nbsp;&nbsp;&nbsp;":t.F_HeparinAmount+t.F_HeparinUnit)+'&nbsp;                                    <\/div>                                <\/div>                                <div class="rows">                                    <div style="float: left;width: 49%;">                                        <strong>透析器&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+t.F_DialyzerTypeName1+'                                    <\/div>                                    <div style="float: right;width: 50%;">                                        <strong>灌流器&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+t.F_DialyzerTypeName2+'                                    <\/div>                                <\/div>                                <div class="rows">                                    <div style="float: left;width: 49%;">                                        <strong>血流速&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_BloodSpeed===null?"&nbsp;&nbsp;&nbsp;":t.F_BloodSpeed)+'&nbsp;ml/min                                    <\/div>                                    <div style="float: right;width: 25%;">                                        <strong>透析液温度&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_DialysateTemperature===null?"&nbsp;&nbsp;&nbsp;":t.F_DialysateTemperature)+'&nbsp;℃                                    <\/div>                                    <div style="float: right;width: 25%;">                                        <strong>预估时间&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_EstimateHours===null?"&nbsp;&nbsp;&nbsp;":t.F_EstimateHours)+'&nbsp;h                                    <\/div>                                <\/div>                                <div class="rows">                                    <div style="float: left;width: 19%;">                                        <strong>透析液&nbsp;&nbsp;<\/strong>                                    <\/div>                                    <div style="float: right;width: 20%;">                                        <strong>HCO<sub>3<\/sub><sup>-<\/sup>&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_Hco3===null?"&nbsp;&nbsp;&nbsp;":t.F_Hco3)+'&nbsp;                                    <\/div>                                    <div style="float: right;width: 20%;">                                        <strong>Na&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_Na===null?"&nbsp;&nbsp;&nbsp;":t.F_Na)+'&nbsp;                                    <\/div>                                    <div style="float: right;width: 20%;">                                        <strong>K&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_K===null?"&nbsp;&nbsp;&nbsp;":t.F_K)+'&nbsp;                                    <\/div>                                    <div style="float: right;width: 20%;">                                        <strong>Ca&nbsp;&nbsp;<\/strong>&nbsp;&nbsp;'+(t.F_Ca===null?"&nbsp;&nbsp;&nbsp;":t.F_Ca)+'&nbsp;                                    <\/div>                                <\/div>                            <\/div>                            <div class="panel-footer">                                <strong>日期：'+t.F_CreatorTime+'<\/strong>                                <strong style="float: right;margin-right: 10px;">签名：'+t.F_DoctorName+'<\/strong>                                <i style="float: right;margin-right: 30px;font-size: 18px;" class="fa fa-star-o fa-lg"><\/i>                            <\/div>                        <\/div>                    <\/div>                    '}),t=$("#a").find("div.rows").first(),t.empty(),t.html(""),t.html(i),n.length>0)t.find("i.fa").on("click",function(n){var i=$(n.currentTarget),t=i.parent().parent(),r;i.is(".fa-trash")?(t=t.parent(),$.modalConfirm("注：您确定要【删除】该项吗？",function(n){n&&$.submitForm({url:"/PatientManage/Setting/DeleteForm",param:{keyValue:t[0].id},success:function(){settxcs()}})})):i.is(".fa-edit")?(t=t.parent(),r={},r.pid=currentId,r.keyValue=t[0].id,$.modalOpen({id:"Form",title:"修改透析参数",url:"/PatientManage/Setting/Form?keyValue="+encodeURI(JSON.stringify(r)),width:"800px",height:"600px",callBack:function(n){top.frames[n].submitData()}})):i.is(".fa-star-o")&&$.modalConfirm("注：您确定要保存该项为模板吗？",function(n){n&&$.submitForm({url:"/PatientManage/Setting/SaveModel",param:{keyValue:t[0].id},success:function(){}})})})}})}function setaccess(){$.ajax({url:"/PatientManage/VascularAccess/GetListJson",data:{keyword:currentId},dataType:"json",async:!1,success:function(n){var i=$("#access-list"),t;if(i.html(""),n.length>0){t="";n.forEach(function(n){t=t+'<a class="list-group-item" id="'+n.F_Id+'"> '+(n.F_EnabledMark===!0?'<span class="badge badge-success">启<\/span>':'<span class="badge">停<\/span>')+'<h6 class="list-group-item-heading">'+new Date(n.F_OperateTime).Format("yyyy-MM-dd")+'<\/h6><p class="list-group-item-text">'+n.F_Type+"&nbsp;&nbsp;&nbsp;"+n.F_VascularAccess+"&nbsp;&nbsp;&nbsp;"+n.F_BodyPart+"<\/p><\/a>"});i.html(t);i.find(".list-group-item").on("click",function(n){!n.currentTarget.id||(accessId=n.currentTarget.id,$.ajax({url:"/PatientManage/VascularAccess/GetFormJson",data:{keyValue:accessId},dataType:"json",async:!1,success:function(n){var t={};t.B_Id=n.F_Id;t.B_OperateTime=n.F_OperateTime;t.B_FirstUseTime=n.F_FirstUseTime;t.B_Type=n.F_Type;t.B_VascularAccess=n.F_VascularAccess;t.B_BloodSpeed=n.F_BloodSpeed;t.B_BloodSpeed_Idea=n.F_BloodSpeed_Idea;t.B_BodyPart=n.F_BodyPart;t.B_BodyPosition=n.F_BodyPosition;t.B_DisabledRemark=n.F_DisabledRemark;t.B_Pid=n.F_Pid;t.B_Memo=n.F_Memo;t.B_Complication=n.F_Complication;$("#formaccess").formSerialize(t);$.ajax({url:"/PatientManage/VascularAccess/GetVascularAccessPicPath",data:{keyValue:accessId},dataType:"json",async:!1,success:function(n){n.fileName?($("#accessimg").attr("src","\\"+n.filePath+"\\"+n.fileName),$("#accessimg").attr("alt",n.fileName)):($("#accessimg").attr("src",""),$("#accessimg").attr("alt",""))}})}}))})}}})}function setccjl(){$.ajax({url:"/PatientManage/Puncture/GetPuncturePicPath",data:{keyValue:currentId},dataType:"json",async:!1,success:function(n){n.fileName?($("#ccjlimg").attr("src","\\"+n.filePath+"\\"+n.fileName),$("#ccjlimg").attr("alt",n.fileName)):($("#ccjlimg").attr("src",""),$("#ccjlimg").attr("alt",""))}});$.ajax({url:"/PatientManage/Puncture/GetListJson",data:{keyValue:currentId},dataType:"json",async:!1,success:function(n){var i=$("#ccjl-list"),t;if(i.empty(),i.html(""),t="",n.length>0){n.forEach(function(n){t=n.F_IsSuccess===!0?t+'                            <div class="col-xs-6 col-sm-5 col-md-4 col-lg-3">                                <div class="panel panel-default">                                    <div class="panel-heading">                                        <strong style="font-size:15px;">'+n.F_OperateTime.substr(0,10)+'<\/strong>                                        <div style="float: right;" id="'+n.F_Id+'">                                            <i class="fa fa-edit fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                            <i class="fa fa-trash fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                        <\/div>                                    <\/div>                                    <div class="panel-body" style="margin-top: -5px;margin-bottom: -5px;">                                        <strong>穿刺点：&nbsp;<\/strong>&nbsp;'+n.F_Point1+"&nbsp;-&nbsp;"+n.F_Point2+"&nbsp;&nbsp;&nbsp;&nbsp;"+n.F_OperateTime.substr(11,5)+'                                    <\/div>                                    <div class="panel-footer">                                        <strong>签名：'+n.F_RealName+"<\/strong>                                    <\/div>                                <\/div>                            <\/div>                            ":t+'                            <div class="col-xs-6 col-sm-5 col-md-4 col-lg-3">                                <div class="panel panel-default">                                    <div class="panel-heading">                                        <strong style="font-size:15px;">'+n.F_OperateTime.substr(0,10)+'<\/strong>                                        <div style="float: right;" id="'+n.F_Id+'">                                            <i class="fa fa-edit fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                            <i class="fa fa-trash fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                                        <\/div>                                    <\/div>                                    <div class="panel-body" style="margin-top: -5px;margin-bottom: -5px;">                                        <strong>穿刺点：&nbsp;<\/strong>&nbsp;'+n.F_Point1+"&nbsp;-&nbsp;"+n.F_Point2+"&nbsp;&nbsp;&nbsp;&nbsp;"+n.F_OperateTime.substr(11,5)+'                                    <\/div>                                    <div class="panel-footer">                                        <strong>签名：'+n.F_RealName+'<\/strong>                                        <i class="fa fa-circle" style="float: right;margin-right: 8px;font-size: 18px;color: red;" data-toggle="tooltip" data-html="true" data-placement="left" title="'+n.F_Memo+'"><\/i>                                    <\/div>                                <\/div>                            <\/div>                            '});i.html(t);i.find("[data-toggle='tooltip']").tooltip();i.find("i.fa").on("click",function(n){var t=$(n.currentTarget),i=t.parent()[0].id;!i||(t.is(".fa-trash")?$.deleteForm({url:"/PatientManage/Puncture/DeleteForm",param:{keyValue:i},success:function(){setccjl()}}):t.is(".fa-edit")&&$.modalOpen({id:"Form",title:"修改",url:"/PatientManage/Puncture/Form?keyValue="+encodeURI(JSON.stringify({id:i})),width:"800px",height:"600px",callBack:function(n){top.frames[n].submitData()}}))})}}})}function setblws(){$.ajax({url:"/PatientManage/MedicalRecord/GetListJson",data:{patientId:currentId,startDate:$("#bl-startdate").val(),endDate:$("#bl-enddate").val()},dataType:"json",async:!1,success:function(n){var i=$("#bl-list"),t;if(i.empty(),i.html(""),t="",n.length>0){n.forEach(function(n){t=n.auditFlag===!0?t+'                                    <a class="list-group-item" id="'+n.id+'">                                        <h5 class="list-group-item-heading">'+n.contentTime+'<\/h5>                                        <strong class="list-group-item-text">'+n.title+'<\/strong>                                        <i class="list-group-item-text" style="float: right;margin-right: 20px;">'+n.userName+"<\/i>                                    <\/a>                                    ":t+'                                    <a class="list-group-item" id="'+n.id+'">                                        <h5 class="list-group-item-heading">'+n.contentTime+'<\/h5>                                        <strong class="list-group-item-text">'+n.title+'<\/strong>                                        <i class="fa fa-pencil-square" style="float: right;font-size: 22px;margin-top: -6px;margin-right: 5px;"><\/i>                                        <i class="list-group-item-text" style="float: right;margin-right: 20px;">'+n.userName+"<\/i>                                    <\/a>                                    "});i.html(t);i.find("i.fa").on("click",function(n){var t=$(n.currentTarget),i=t.parent()[0].id;!i||t.is(".fa-pencil-square")&&($.modalConfirm("注：您确定要【提交】该项吗？",function(n){n&&$.submitForm({url:"/PatientManage/MedicalRecord/CheckMedicalRecord",param:{keyValue:i},success:function(){setblws();$("#btn-bladd").trigger("click")}})}),event.stopPropagation())});i.find(".list-group-item").on("click",function(n){!n.currentTarget.id||(blwsId=n.currentTarget.id,$.ajax({url:"/PatientManage/MedicalRecord/GetFormJson",data:{keyValue:blwsId},dataType:"json",async:!1,success:function(n){$("#bl-contenttime").val(n.F_ContentTime);$("#bl-title").val(n.F_Title);bleditor.setValue($("<div>").html(n.F_Content).text())}}))})}}})}function setypyz(){$.ajax({url:"/PatientManage/Orders/GetDrugsListJson",data:{patientId:currentId,startDate:$("#yz-startdate").val(),endDate:$("#yz-enddate").val()},dataType:"json",async:!1,success:function(n){var i=$("#yz-list"),t;if(i.empty(),i.html(""),t="",n.length>0){n.forEach(function(n){t=t+'                        <div class="col-xs-6 col-sm-5 col-md-4 col-lg-3">                        ';t=t+'                        <div class="panel panel-default" id="'+n.id+'">                        <div class="panel-heading">                         <strong style="font-size:15px;">'+n.orderStartTime.substr(5,11)+"<\/strong>                        ";t=n.isTemporary===!0?t+'                            <span class="badge" style="background-color: red;">长<\/span>                            ':t+'                            <span class="badge">临<\/span>                            ';t=t+'                        <div style="float: right;">                        '+(n.isTemporary===!0&&n.orderStatus>=1&&n.orderStatus<3?'                        <i class="fa fa-stop-circle fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                        ':"")+'                        <i class="fa fa-trash fa-lg" style="padding-right: 10px;font-size: 18px;"><\/i>                        <\/div>                        ';t=t+"                        <\/div>                        ";t=t+'                        <div class="panel-body" style="padding: 2px 2px 1px 10px;">                        <div class="rows" style="height: 55px;">                        ';$.each(n.rows,function(i,r){t=t+'                            <div style="float: left;width: 60%;">                            <strong>'+r.orderText+'<\/strong>                            <\/div>                            <div style="float: right;width: 10%;">                            <strong>'+(i===0?n.orderFrequency:"&nbsp;")+'<\/strong>                            <\/div>                            <div style="float: right;width: 10%;">                            <strong>'+(i===0?n.orderAdministration===undefined||n.orderAdministration===null?"&nbsp;":n.orderAdministration:"&nbsp;")+'<\/strong>                            <\/div>                            <div style="float: right;width: 20%;">                            <strong>'+r.orderAmount+"&nbsp;"+r.orderUnitSpec+"<\/strong>                            <\/div>                            "});t=t+"                        <\/div>                        <\/div>                        ";t=t+'                        <div class="panel-footer">                        ';switch(n.orderStatus){case 0:t=t+'                                <span class="badge">新<\/span>                                ';t=t+'                                <strong style="float: right;margin-right: 10px;">'+n.doctor+'<\/strong>                                <i style="float: right;margin-right: 30px;font-size: 18px;" class="fa fa-pencil fa-lg"><\/i>                                ';break;case 1:t=t+"                                <strong>签名:"+n.doctorAuditTime.substr(5,11)+'<\/strong>                                <strong style="float: right;margin-right: 10px;">'+n.doctor+"<\/strong>                                ";break;case 2:t=t+"                                <strong>签名:"+n.doctorAuditTime.substr(5,11)+'<\/strong>                                <strong style="float: right;margin-right: 10px;">'+n.doctor+"<\/strong>                                ";break;case 3:t=t+"                                <strong>签名:"+n.orderStopTime.substr(5,11)+'<\/strong>                                <span class="badge">停<\/span>                                ';t=t+'                                <strong style="float: right;margin-right: 10px;">'+n.doctor+"<\/strong>                                "}t=t+"                        <\/div>                        ";t=t+"                        <\/div>                        ";t=t+"                        <\/div>                        "});i.html(t);i.find("i.fa").on("click",function(n){var i=$(n.currentTarget),t;i.is(".fa-stop-circle")?(t=i.parent().parent().parent()[0].id,!t||$.modalConfirm("注：您确定要【停止】该项医嘱吗？",function(n){n&&$.submitForm({url:"/PatientManage/Orders/StopOrder",param:{keyValue:t},success:function(){setypyz()}})})):i.is(".fa-trash")?(t=i.parent().parent().parent()[0].id,!t||$.deleteForm({url:"/PatientManage/Orders/DeleteForm",param:{keyValue:t},success:function(){setypyz()}})):i.is(".fa-pencil")&&(t=i.parent().parent()[0].id,!t||$.modalConfirm("注：您确定要【提交】该项医嘱吗？",function(n){n&&$.submitForm({url:"/PatientManage/Orders/CheckOrder",param:{keyValue:t},success:function(){setypyz()}})}))});i.find(".list-group-item").on("click",function(n){!n.currentTarget.id||(blwsId=n.currentTarget.id,$.ajax({url:"/PatientManage/MedicalRecord/GetFormJson",data:{keyValue:blwsId},dataType:"json",async:!1,success:function(n){$("#bl-contenttime").val(n.F_ContentTime);$("#bl-title").val(n.F_Title);bleditor.setValue($("<div>").html(n.F_Content).text())}}))})}}})}function settransfer(){$.ajax({url:"/PatientManage/Patient/GetTransferListJson",data:{patientId:currentId},dataType:"json",async:!1,success:function(n){var i=$("#transferContent"),t;i.empty();i.html("");t="";$.isArray(n)&&n.length>0&&n.forEach(function(n){t=t+'                                <span class="timeline-label">                                    <span class="label label-primary">'+n.F_TransferDate.substr(0,10)+"<\/span>                                <\/span>                                ";switch(n.F_Status){case"转入":t=t+'                                    <div class="timeline-item">                                        <div class="timeline-point">                                            <i class="fa fa-arrow-circle-right" style="color: greenyellow;"><\/i>                                        <\/div>                                        <div class="timeline-event">                                            <div class="timeline-heading">                                                <h5>转入<i class="fa fa-times fa-lg" style="float: right;margin-right: 20px;" id="'+n.F_Id+'"><\/i><\/h5>                                            <\/div>                                            <div class="timeline-body">                                                <p>由&nbsp;'+(n.F_LocationOut==null?"":n.F_LocationOut)+"&nbsp;转入"+(n.F_TransferReason==null?"":n.F_TransferReason)+"&nbsp;&nbsp;"+(n.F_Memo==null?"":n.F_Memo)+"<\/p>                                            <\/div>                                        <\/div>                                    <\/div>                                    ";break;case"转出":t=t+'                                    <div class="timeline-item">                                        <div class="timeline-point timeline-point-primary">                                            <i class="fa fa-arrow-circle-left" style="color: blue;"><\/i>                                        <\/div>                                        <div class="timeline-event timeline-event-primary">                                            <div class="timeline-heading">                                                <h5>转出<i class="fa fa-times fa-lg" style="float: right;margin-right: 20px;" id="'+n.F_Id+'"><\/i><\/h5>                                            <\/div>                                            <div class="timeline-body">                                                 <p>'+(n.F_LocationOut==null?"":n.F_LocationOut)+"&nbsp;&nbsp;"+(n.F_TransferReason==null?"":n.F_TransferReason)+"&nbsp;&nbsp;"+(n.F_Memo==null?"":n.F_Memo)+"<\/p>                                            <\/div>                                        <\/div>                                    <\/div>                                    ";break;case"退出":t=t+'                                    <div class="timeline-item">                                        <div class="timeline-point timeline-point-warning">                                            <i class="fa fa-sign-out"><\/i>                                        <\/div>                                        <div class="timeline-event timeline-event-warning">                                            <div class="timeline-heading">                                                <h5>退出<i class="fa fa-times fa-lg" style="float: right;margin-right: 20px;" id="'+n.F_Id+'"><\/i><\/h5>                                            <\/div>                                            <div class="timeline-body">                                                <p>'+(n.F_ExitType==null?"":n.F_ExitType)+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+(n.F_ExitReason==null?"":n.F_ExitReason)+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+(n.F_Memo==null?"":n.F_Memo)+"<\/p>                                            <\/div>                                        <\/div>                                    <\/div>                                    ";break;case"短期":t=t+'                                    <div class="timeline-item">                                        <div class="timeline-point timeline-point-success">                                            <i class="fa fa-star"><\/i>                                        <\/div>                                        <div class="timeline-event timeline-event-success">                                            <div class="timeline-heading">                                                <h5>短期<i class="fa fa-times fa-lg" style="float: right;margin-right: 20px;" id="'+n.F_Id+'"><\/i><\/h5>                                            <\/div>                                            <div class="timeline-body">                                                <p>临时透析&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+(n.F_Memo==null?"":n.F_Memo)+"<\/p>                                            <\/div>                                        <\/div>                                    <\/div>                                    "}});t=t+'                        <span class="timeline-label">                            <a class="btn btn-primary fa-lg"><i class="fa fa-plus-circle"><\/i><\/a>                        <\/span>                        ';i.html(t);i.find("a.btn").on("click",function(){!currentId||$.modalOpen({id:"Form",title:"新建转归记录",url:"/PatientManage/Patient/Transfer?keyword="+currentId,width:"600px",height:"500px",callBack:function(n){top.frames[n].submitForm()}})});i.find("i.fa-times").on("click",function(n){$.deleteForm({url:"/PatientManage/Patient/DeleteTransfer",param:{keyValue:n.currentTarget.id},success:function(){settransfer()}})})}})}var currentId=null,accessId=null,blwsId=null,bleditor=null,drugList=[],drugsDict=[],heparinList=[];$(function(){$(".wrapper").height($(window).height()-50);initControl();$("#btn-choose").on("click",function(){$.modalOpen({id:"Choose",title:"选择患者",url:"/PatientManage/Patient/Choose?keyValue="+currentId,width:"800px",height:"600px",callBack:function(n){top.frames[n].submitForm()}})})});Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};